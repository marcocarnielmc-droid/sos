<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flowchart Violenza – Ticino (Info)</title>
  <style>
    :root{
      --bg:#f7f8fb; --card:#fff; --text:#0f172a; --muted:#475569;
      --border:#e2e8f0; --primary:#0f172a; --primaryText:#fff;
      --hi:#b91c1c; --med:#0f766e; --low:#334155;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: linear-gradient(180deg, var(--bg), #fff);
      color:var(--text);
    }
    .wrap{max-width:980px; margin:0 auto; padding:16px;}
    h1{font-size:22px; margin:0 0 4px;}
    .sub{color:var(--muted); font-size:13px; margin:0 0 14px; line-height:1.35;}
    .grid{display:grid; gap:12px;}
    @media (min-width: 920px){ .grid{grid-template-columns: 1fr 1fr;} }
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:16px;
      padding:14px; box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }
    .card h2{font-size:16px; margin:0 0 8px;}
    .help{color:var(--muted); font-size:13px; margin:0 0 10px; line-height:1.35;}
    .sep{height:1px; background:var(--border); margin:12px 0;}
    .twoCol{display:grid; gap:10px;}
    @media (min-width: 560px){ .twoCol{grid-template-columns: 1fr 1fr;} }
    .choice{
      display:flex; gap:10px; align-items:flex-start;
      border:1px solid var(--border); border-radius:14px; padding:12px; background:#fff;
      cursor:pointer;
    }
    .choice input{margin-top:2px}
    .choice strong{display:block; font-size:14px;}
    .choice span{display:block; color:var(--muted); font-size:13px; margin-top:2px;}
    .list{display:grid; gap:10px;}
    .item{
      border:1px solid var(--border); border-radius:14px; padding:12px;
      background:#fff;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:flex-start; justify-content:space-between;}
    .title{font-weight:900; margin:0; font-size:14px;}
    .desc{margin:2px 0 0; color:var(--muted); font-size:13px; line-height:1.35;}
    .badge{
      display:inline-flex; align-items:center; padding:4px 9px; border-radius:999px;
      font-size:12px; font-weight:900; border:1px solid var(--border); background:#fff;
      white-space:nowrap;
    }
    .badge.hi{border-color:#fecaca; background:#fff1f2; color:var(--hi);}
    .badge.med{border-color:#99f6e4; background:#f0fdfa; color:var(--med);}
    .badge.low{border-color:#cbd5e1; background:#f8fafc; color:var(--low);}
    .pill{display:inline-block; padding:2px 8px; border-radius:999px; background:#f1f5f9; color:#0f172a; font-weight:900; font-size:12px; border:1px solid var(--border);}
    .note{
      border:1px solid var(--border); border-radius:14px; padding:12px; background:#fff;
      color:var(--muted); font-size:13px; line-height:1.35;
    }
    .muted{color:var(--muted)}
    .footer{margin-top:10px; font-size:12px; color:var(--muted); line-height:1.35;}
  </style>
</head>
<body>
<div class="wrap">
  <h1>Flowchart Violenza – Canton Ticino (Informativo)</h1>
  <p class="sub">
    Seleziona <span class="pill">tipo cliente/contesto</span> e <span class="pill">urgenza</span>.
    Sotto vedrai <strong>chi attivare in ordine di priorità</strong>. (Numeri fissi mostrati; altri enti senza numero.)
  </p>

  <div class="grid">
    <div class="card">
      <h2>1) Tipo cliente / contesto (checkbox)</h2>
      <p class="help">Puoi selezionare più voci. Esempio: “Donna” + “Minori coinvolti”.</p>

      <div class="twoCol">
        <label class="choice"><input type="checkbox" id="c_donna">
          <div><strong>Donna (vittima)</strong><span>Violenza di coppia / domestica</span></div>
        </label>

        <label class="choice"><input type="checkbox" id="c_uomo">
          <div><strong>Uomo (vittima)</strong><span>Violenza di coppia / domestica</span></div>
        </label>

        <label class="choice"><input type="checkbox" id="c_minore">
          <div><strong>Minore (vittima)</strong><span>Maltrattamento / abuso / trascuratezza</span></div>
        </label>

        <label class="choice"><input type="checkbox" id="c_violenzaAssistita">
          <div><strong>Minori coinvolti (violenza assistita)</strong><span>Bambini presenti/testimoni nel contesto domestico</span></div>
        </label>

        <label class="choice"><input type="checkbox" id="c_anziano">
          <div><strong>Anziano / adulto vulnerabile</strong><span>Fragilità/dipendenza, possibile abuso</span></div>
        </label>

        <label class="choice"><input type="checkbox" id="c_autore">
          <div><strong>Paziente autore di violenza</strong><span>Rischio verso terzi (partner/famiglia)</span></div>
        </label>

        <label class="choice"><input type="checkbox" id="c_sessuale">
          <div><strong>Violenza sessuale</strong><span>Sospetta o dichiarata</span></div>
        </label>
      </div>

      <div class="sep"></div>

      <h2>2) Urgenza (radio)</h2>
      <p class="help">Una sola scelta.</p>

      <div class="list">
        <label class="choice"><input type="radio" name="u" value="immediato">
          <div><strong>Pericolo immediato</strong><span>Aggressione in corso, minacce credibili, armi, rischio vita nelle prossime ore</span></div>
        </label>

        <label class="choice"><input type="radio" name="u" value="medico">
          <div><strong>Emergenza medica</strong><span>Lesioni importanti / rischio vita / necessità ambulanza</span></div>
        </label>

        <label class="choice"><input type="radio" name="u" value="sessuale72">
          <div><strong>Violenza sessuale recente (&lt; ~72h)</strong><span>Percorso medico-legale tempestivo</span></div>
        </label>

        <label class="choice"><input type="radio" name="u" value="nonImmediato">
          <div><strong>Non immediato (ma concreto)</strong><span>Violenza ricorrente, controllo coercitivo, rischio significativo ma non nelle prossime ore</span></div>
        </label>

        <label class="choice"><input type="radio" name="u" value="sospetto">
          <div><strong>Sospetto / segnali indiretti</strong><span>Nessuna conferma; utile équipe, follow-up, rete</span></div>
        </label>
      </div>
    </div>

    <div class="card">
      <h2>3) Chi attivare (priorità)</h2>
      <p class="help">Comparirà una lista ordinata dal più importante/utile al meno, in base alle scelte.</p>

      <div id="out" class="list"></div>

      <div class="sep"></div>

      <div class="note">
        <strong>Regola d’oro</strong><br>
        Se c’è <span class="pill">pericolo immediato</span> → priorità <span class="pill">117</span>.
        Se c’è <span class="pill">emergenza medica</span> → priorità <span class="pill">144</span>.
      </div>

      <div class="sep"></div>

      <div class="note">
        <strong>Promemoria concettuale</strong><br>
        <span class="pill">ARP</span> = decisione formale (minori/adulti vulnerabili).<br>
        <span class="pill">UAP</span> = sostegno socio-educativo volontario.<br>
        <span class="pill">LAVI</span> = aiuto alle vittime (supporto psicologico/legale/economico).
      </div>
    </div>
  </div>

  <div class="footer">
    Numeri fissi: <strong>117</strong> Polizia • <strong>144</strong> Ambulanza • <strong>112</strong> Emergenze UE • <strong>143</strong> Supporto emotivo (La Main Tendue).
  </div>
</div>

<script>
(() => {
  const out = document.getElementById("out");

  const state = {
    c: { donna:false,uomo:false,minore:false,violenzaAssistita:false,anziano:false,autore:false,sessuale:false },
    u: null
  };

  // Fixed items (informative)
  const FIX = {
    police: { name:"Polizia", number:"117", why:"Pericolo immediato, minacce credibili, armi, aggressione in corso" },
    ambulance: { name:"Ambulanza", number:"144", why:"Emergenza sanitaria / lesioni / rischio vita" },
    euro: { name:"Emergenze UE", number:"112", why:"Alternativa emergenza" },
    helpline: { name:"La Main Tendue", number:"143", why:"Supporto emotivo 24/7" },
    arp: { name:"ARP (Autorità Regionale di Protezione)", number:"—", why:"Decisioni formali: minori / adulti vulnerabili" },
    uap: { name:"UAP (Ufficio Aiuto e Protezione)", number:"—", why:"Sostegno socio-educativo volontario" },
    lavi: { name:"LAVI Ticino", number:"—", why:"Aiuto alle vittime: supporto psicologico/legale/economico" },
    refuge: { name:"Casa rifugio / struttura protetta", number:"—", why:"Protezione abitativa immediata (volontaria)" },
    smp: { name:"SMP (Servizio Medico Psicologico)", number:"—", why:"Valutazione/presa in carico specialistica minori" },
    socials: { name:"Servizi sociali comunali", number:"—", why:"Supporto sociale/abitativo/rete" },
    internal: { name:"Direzione sanitaria / reperibilità interna", number:"—", why:"Coordinamento clinico e decisionale" },
    medlegal: { name:"Pronto soccorso / Medicina legale", number:"—", why:"Percorso medico-legale tempestivo" }
  };

  function badge(p){
    const cls = p==="HIGH" ? "hi" : (p==="MED" ? "med" : "low");
    const label = p==="HIGH" ? "Priorità alta" : (p==="MED" ? "Priorità media" : "Supporto");
    return `<span class="badge ${cls}">${label}</span>`;
  }

  function renderPlan(plan){
    out.innerHTML = "";
    if(!plan.length){
      out.innerHTML = `<div class="note">Seleziona almeno una urgenza per vedere la priorità degli enti.</div>`;
      return;
    }
    plan.forEach((it, i) => {
      out.insertAdjacentHTML("beforeend", `
        <div class="item">
          <div class="row">
            <div style="flex:1; min-width:240px;">
              <p class="title">${i+1}. ${it.name}</p>
              <p class="desc">${it.why} <span class="muted">• ${it.number}</span></p>
            </div>
            ${badge(it.p)}
          </div>
        </div>
      `);
    });
  }

  function buildPlan(){
    const a = state.c;
    const u = state.u;

    const plan = [];
    const push = (p, x) => plan.push({ p, ...x });

    const minorsInvolved = a.minore || a.violenzaAssistita;
    const vulnerableAdult = a.anziano;

    // Emergency rules
    if (u === "immediato"){
      push("HIGH", FIX.police);
      push("MED", FIX.ambulance);
      return plan;
    }
    if (u === "medico"){
      push("HIGH", FIX.ambulance);
      push("MED", FIX.police);
      return plan;
    }
    if (u === "sessuale72"){
      push("HIGH", FIX.police);
      push("HIGH", FIX.medlegal);
      push("MED", FIX.lavi);
      if (minorsInvolved) push("HIGH", FIX.arp);
      return plan;
    }

    if (u === "nonImmediato"){
      if (minorsInvolved){
        push("HIGH", FIX.arp);
        push("MED", FIX.uap);
        push("MED", FIX.smp);
        push("LOW", FIX.socials);
        if (a.donna || a.uomo) push("LOW", FIX.lavi);
        return plan;
      }
      if (vulnerableAdult){
        push("HIGH", FIX.arp);
        push("MED", FIX.socials);
        push("LOW", FIX.lavi);
        return plan;
      }
      if (a.autore){
        push("HIGH", FIX.internal);
        push("MED", { name:"Valutazione rischio strutturata", number:"—", why:"Procedura interna (credibilità e imminenza)" });
        push("LOW", FIX.police);
        return plan;
      }
      if (a.donna || a.uomo){
        push("HIGH", FIX.lavi);
        push("MED", FIX.refuge);
        push("LOW", FIX.socials);
        push("LOW", FIX.helpline);
        return plan;
      }
      if (a.sessuale){
        push("HIGH", FIX.lavi);
        push("MED", FIX.medlegal);
        if (minorsInvolved) push("HIGH", FIX.arp);
        return plan;
      }
      push("HIGH", { name:"Valutazione clinica + rete", number:"—", why:"Definire rischio e attivare risorse appropriate" });
      push("LOW", FIX.helpline);
      return plan;
    }

    if (u === "sospetto"){
      push("HIGH", { name:"Discussione in équipe", number:"—", why:"Condividere elementi e decidere follow-up/accertamenti" });
      if (minorsInvolved){
        push("MED", FIX.uap);
        push("MED", FIX.smp);
        push("LOW", FIX.arp);
      } else if (vulnerableAdult){
        push("MED", FIX.socials);
        push("LOW", FIX.arp);
      } else if (a.donna || a.uomo){
        push("MED", FIX.lavi);
        push("LOW", FIX.helpline);
      } else if (a.autore){
        push("MED", FIX.internal);
      } else {
        push("LOW", FIX.helpline);
      }
      return plan;
    }

    return plan;
  }

  // Bind checkboxes
  const bindCheck = (id, key) => {
    const el = document.getElementById(id);
    el.addEventListener("change", () => {
      state.c[key] = el.checked;
      renderPlan(buildPlan());
    });
  };
  bindCheck("c_donna","donna");
  bindCheck("c_uomo","uomo");
  bindCheck("c_minore","minore");
  bindCheck("c_violenzaAssistita","violenzaAssistita");
  bindCheck("c_anziano","anziano");
  bindCheck("c_autore","autore");
  bindCheck("c_sessuale","sessuale");

  // Bind radios
  document.querySelectorAll('input[name="u"]').forEach(r => {
    r.addEventListener("change", () => {
      state.u = r.value;
      renderPlan(buildPlan());
    });
  });

  // initial
  renderPlan([]);
})();
</script>
</body>
</html>
